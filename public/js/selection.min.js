!function(){function a(a){var b=a.getAttribute("data-src");console.log("voice src: [] "+b);var c=document.createElement("audio");c.setAttribute("src",b),a.appendChild(c),c.addEventListener("ended",function(){console.log("loading src: "+this.getAttribute("src")),this.load()}),a.addEventListener("click",function(){console.log("playing src: "+c.getAttribute("src")),c.play()})}function b(a,b){return a.top===b.top&&a.bottom===b.bottom&&a.left===b.left&&a.right===b.right?!0:!1}var c={top:0,bottom:0,left:0,right:0,again:0},d=function(a){var d=window.getSelection&&window.getSelection();if(d&&d.rangeCount>0){var g=trim(d.toString()),h=d.getRangeAt(0).getBoundingClientRect();if(b(h,c)&&c.again)return void(c.again=0);if(""===g||!/[a-zA-Z\s]/.test(g))return;chrome.storage.sync.set({currentWord:g},function(){});for(var i in c)c[i]="again"==i?1:h[i];var j={};chrome.storage.sync.get(null,function(b){for(var c in b)j[c]=b[c];"side"==j.showPosition&&e(g),"near"==j.showPosition&&f(g,h,a)})}},e=function(a){var b=h(a);b.classList.add("ChaZD-result-side"),document.documentElement.appendChild(b)},f=function(a,b,c){var d=h(a),e=g();document.documentElement.appendChild(d),document.documentElement.appendChild(e);var f={};0===b.left&&0===b.top&&(b={left:c.clientX,top:c.clientY,height:15});var i=d.offsetWidth,j=b.right-b.left,k=b.left+window.pageXOffset,l=b.top+window.pageYOffset,m=j/2+k,n=k-(i-j)/2,o=m-12;n<window.pageXOffset?n=window.pageXOffset:n+i>window.pageXOffset+document.documentElement.clientWidth&&(n=window.pageXOffset+document.documentElement.clientWidth-i);var p=0;if(p=document.documentElement.clientHeight>document.body.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,0===p&&(p=document.documentElement.clientHeight),b.top>=150){var q=p-l+10,r=q+1;f={left:n,bottom:q,arrowLeft:o,arrowBottom:r}}else f={left:n,top:l+b.height+12,arrowLeft:o,arrowTop:l+b.height+1};d.style.left=f.left+"px",e.style.left=f.arrowLeft+"px",f.bottom&&(d.style.bottom=f.bottom+"px",e.style.bottom=f.arrowBottom+"px",document.getElementById("ChaZD-arrow-outer").classList.add("ChaZD-arrow-outer-down"),document.getElementById("ChaZD-arrow-inner").classList.add("ChaZD-arrow-inner-down")),f.top&&(d.style.top=f.top+"px",e.style.top=f.arrowTop+"px",document.getElementById("ChaZD-arrow-outer").classList.add("ChaZD-arrow-outer-up"),document.getElementById("ChaZD-arrow-inner").classList.add("ChaZD-arrow-inner-up"))},g=function(){var a=document.createElement("div");a.classList.add("ChaZD-arrow-main");var b=document.createElement("div");b.setAttribute("id","ChaZD-arrow-outer");var c=document.createElement("div");return c.setAttribute("id","ChaZD-arrow-inner"),a.appendChild(b),a.appendChild(c),a},h=function(b){var c=document.createElement("div");c.classList.add("ChaZD-result-container"),c.setAttribute("data-text",b);var d=document.createElement("div");return d.setAttribute("id","ChaZD-searching"),d.innerHTML="ψ(._. )>划词君正在翻译。。。",c.appendChild(d),chrome.runtime.sendMessage({queryWord:b,source:"select"},function(b){var e=b;if(d.innerHTML="","query success"===e.validMessage){c.innerHTML=e.titleBlock;var f=c.querySelector(".voice-container");a(f),console.log("inner onclick:"+f.onclick),console.log(document.querySelector(".voice-container")===f);var g=document.createElement("div");e.basicBlock?(g.innerHTML=e.basicBlock,c.appendChild(g)):e.haveTranslation?c.querySelector(".title-translation").style.display="block":e.haveWebTranslation?(g.innerHTML=e.webBlock,c.appendChild(g),c.querySelector(".web-title").innerHTML="网络释义"):c.innerHTML="╮(╯▽╰)╭划词君无能为力啊<br> 还是右键问问谷歌君吧=>"}else c.innerHTML=20==e.errorCode?"<p>这段文字太长，词典君无能为力了（┬_┬） <br><br>试试短一点的吧~</p>":40==e.errorCode?"<p>对不起，这段文字太高深了，请饶过词典君吧（┬_┬）</p>":"<p>词典君罢工啦（┬_┬）<br><br> 是不是网络不太好？<br><br> 稍后再试一次吧</p>"}),c},i=!0,j=!1,k="ctrl",l=!1;chrome.storage.sync.get(null,function(a){i="noSelect"===a.selectMode?!0:!1,j="useCtrl"===a.selectMode?!0:!1,k=a.toggleKey,l=a.linkQuery}),chrome.storage.onChanged.addListener(function(a){for(var b in a)console.log("[ChaZD]Settings Update, [%s] %s => %s",b,a[b].oldValue,a[b].newValue);if(void 0!==a.linkQuery&&(l=a.linkQuery.newValue),void 0!==a.selectMode){var c=a.selectMode.newValue;i="noSelect"===c?!0:!1,j="useCtrl"===c?!0:!1}void 0!==a.toggleKey&&(k=a.toggleKey.newValue)});var m=["ChaZD-result-container","title-container","title-word","title-translation","basic-container","phonetic-container","explains-container","explains-container","explains-list","property-container","explains-item","voice-container","us-phonetic-container","uk-phonetic-container","web-explains-container","web-explains-list","web-key","explains-item-value","web-value"];document.documentElement.addEventListener("mousedown",function(a){for(var b in m)if(a.target.classList.contains(m[b]))return;var c=document.querySelector(".ChaZD-result-container"),d=document.querySelector(".ChaZD-arrow-main");c&&document.documentElement.removeChild(c),d&&document.documentElement.removeChild(d),chrome.storage.sync.set({currentWord:""}),t(a)}),window.addEventListener("resize",function(){var a=document.querySelector(".ChaZD-result-container"),b=document.querySelector(".ChaZD-arrow-main");a&&document.documentElement.removeChild(a),b&&document.documentElement.removeChild(b)});var n=function(a){if(!i){if(j)if("ctrl"===k){if(!a.ctrlKey&&!a.metaKey)return void(c.again=0)}else if("alt"===k){if(!a.altKey)return void(c.again=0)}else if("shift"===k&&!a.shiftKey)return void(c.again=0);d(a)}},o=null,p=function(a){l&&(a.stopPropagation(),o=this,a.shiftKey&&r(a))},q=function(a){l&&(a.stopPropagation(),o&&o.classList.contains("ChaZD-link")&&s(a,!0),o=null)},r=function(a){o&&a.shiftKey&&(o.setAttribute("ChaZD-href",o.getAttribute("href")),o.removeAttribute("href"),o.classList.add("ChaZD-link"))},s=function(a,b){o&&(b||16==a.keyCode)&&(o.setAttribute("href",o.getAttribute("ChaZD-href")),o.removeAttribute("ChaZD-href"),o.classList.remove("ChaZD-link"))},t=function(a){l&&0===a.button&&a.shiftKey&&window.getSelection().empty()};document.documentElement.addEventListener("mouseup",n);for(var u=document.querySelectorAll("a"),v=0,w=u.length;w>v;v++)u[v].addEventListener("mouseenter",p),u[v].addEventListener("mouseleave",q);document.documentElement.addEventListener("keydown",r),document.documentElement.addEventListener("keyup",s),document.documentElement.addEventListener("selectstart",n)}();
//# sourceMappingURL=selection.min.js.map