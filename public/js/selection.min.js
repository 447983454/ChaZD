!function(){function a(a){var b=a.getAttribute("data-src"),c=document.createElement("audio");c.setAttribute("src",b+"&type="+q),a.appendChild(c),n===!0&&c.play(),c.addEventListener("ended",function(){this.load()}),a.addEventListener("click",function(){c.play()})}function b(a,b){return a.top===b.top&&a.bottom===b.bottom&&a.left===b.left&&a.right===b.right?!0:!1}var c,d={top:0,bottom:0,left:0,right:0,again:0},e=function(a){var c=window.getSelection&&window.getSelection();if(c&&c.rangeCount>0){var e=trim(c.toString()),h=c.getRangeAt(0).getBoundingClientRect();if(b(h,d)&&d.again)return void(d.again=0);if(""===e||!/[a-zA-Z\s]/.test(e))return;chrome.storage.sync.set({currentWord:e},function(){});for(var i in d)d[i]="again"==i?1:h[i];var j={};chrome.storage.sync.get(null,function(b){for(var c in b)j[c]=b[c];"side"==j.showPosition&&f(e),"near"==j.showPosition&&g(e,h,a)})}},f=function(a){var b=i(a);b.classList.add("ChaZD-result-side"),document.documentElement.appendChild(b),o&&(c=setTimeout(function(){document.querySelector(".ChaZD-result-container")&&document.documentElement.removeChild(b)},1e3*p))},g=function(a,b,d){var e=i(a),f=h();document.documentElement.appendChild(e),document.documentElement.appendChild(f);var g={};0===b.left&&0===b.top&&(b={left:d.clientX,top:d.clientY,height:15});var j=e.offsetWidth,k=b.right-b.left,l=b.left+window.pageXOffset,m=b.top+window.pageYOffset,n=k/2+l,q=l-(j-k)/2,r=n-12;q<window.pageXOffset?q=window.pageXOffset:q+j>window.pageXOffset+document.documentElement.clientWidth&&(q=window.pageXOffset+document.documentElement.clientWidth-j);var s=0;if(s=document.documentElement.clientHeight>document.body.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,0===s&&(s=document.documentElement.clientHeight),b.top>=150){var t=s-m+10,u=t+1;g={left:q,bottom:t,arrowLeft:r,arrowBottom:u}}else g={left:q,top:m+b.height+12,arrowLeft:r,arrowTop:m+b.height+1};e.style.left=g.left+"px",f.style.left=g.arrowLeft+"px";var v,w,x=document.querySelectorAll(".ChaZD-arrow-outer"),y=document.querySelectorAll(".ChaZD-arrow-inner");if(g.bottom)for(e.style.bottom=g.bottom+"px",f.style.bottom=g.arrowBottom+"px",v=0,w=x.length;w>v;v++)x[v].classList.add("ChaZD-arrow-outer-down"),y[v].classList.add("ChaZD-arrow-inner-down");if(g.top)for(e.style.top=g.top+"px",f.style.top=g.arrowTop+"px",v=0,w=x.length;w>v;v++)x[v].classList.add("ChaZD-arrow-outer-up"),y[v].classList.add("ChaZD-arrow-inner-up");o&&(c=setTimeout(function(){document.querySelector(".ChaZD-result-container")&&document.querySelector(".ChaZD-arrow-main")&&(document.documentElement.removeChild(e),document.documentElement.removeChild(f))},1e3*p))},h=function(){var a=document.createElement("div");a.classList.add("ChaZD-arrow-main");var b=document.createElement("div");b.setAttribute("class","ChaZD-arrow-outer");var c=document.createElement("div");return c.setAttribute("class","ChaZD-arrow-inner"),a.appendChild(b),a.appendChild(c),a},i=function(b){var c=document.createElement("div");c.classList.add("ChaZD-result-container"),c.setAttribute("data-text",b);var d=document.createElement("div");return d.setAttribute("id","ChaZD-searching"),d.innerHTML="ψ(._. )>划词君正在翻译。。。",c.appendChild(d),chrome.runtime.sendMessage({queryWord:b,source:"select"},function(b){var e=b;if(d.innerHTML="","query success"===e.validMessage){c.innerHTML=e.titleBlock;var f=c.querySelector(".voice-container");a(f);var g=document.createElement("div");e.basicBlock?(g.innerHTML=e.basicBlock,c.appendChild(g)):e.haveTranslation?c.querySelector(".title-translation").style.display="block":e.haveWebTranslation?(g.innerHTML=e.webBlock,c.appendChild(g),c.querySelector(".web-title").innerHTML="网络释义"):c.innerHTML="╮(╯▽╰)╭划词君无能为力啊<br> 还是右键问问谷歌君吧=>"}else c.innerHTML=20==e.errorCode?"<p>这段文字太长，词典君无能为力了（┬_┬） <br><br>试试短一点的吧~</p>":40==e.errorCode?"<p>对不起，这段文字太高深了，请饶过词典君吧（┬_┬）</p>":"<p>词典君罢工啦（┬_┬）<br><br> 是不是网络不太好？<br><br> 稍后再试一次吧</p>"}),c},j=!0,k=!1,l="ctrl",m=!1,n=!1,o=!1,p=3,q=1;chrome.storage.sync.get(null,function(a){j="noSelect"===a.selectMode?!0:!1,k="useCtrl"===a.selectMode?!0:!1,l=a.toggleKey,m=a.linkQuery,n=a.autoAudio,o=a.autoHide,p=a.showDuration,q=a.defaultVoice}),chrome.storage.onChanged.addListener(function(a){if(void 0!==a.linkQuery&&(m=a.linkQuery.newValue),void 0!==a.autoAudio&&(n=a.autoAudio.newValue),void 0!==a.defaultVoice&&(q=a.defaultVoice.newValue),void 0!==a.selectMode){var b=a.selectMode.newValue;j="noSelect"===b?!0:!1,k="useCtrl"===b?!0:!1}void 0!==a.toggleKey&&(l=a.toggleKey.newValue),void 0!==a.autoHide&&(o=a.autoHide.newValue),void 0!==a.showDuration&&(p=a.showDuration.newValue)});var r=["ChaZD-result-container","title-container","title-word","title-translation","basic-container","phonetic-container","explains-container","explains-container","explains-list","property-container","explains-item","voice-container","us-phonetic-container","uk-phonetic-container","web-explains-container","web-explains-list","web-key","explains-item-value","web-value"];document.documentElement.addEventListener("mousedown",function(a){for(var b in r)if(a.target.classList.contains(r[b]))return;clearTimeout(c);var d,e,f=document.querySelectorAll(".ChaZD-result-container"),g=document.querySelectorAll(".ChaZD-arrow-main");if(f)for(d=0,e=f.length;e>d;d++)document.documentElement.removeChild(f[d]);if(g)for(d=0,e=g.length;e>d;d++)document.documentElement.removeChild(g[d]);chrome.storage.sync.set({currentWord:""})}),window.addEventListener("resize",function(){var a=document.querySelector(".ChaZD-result-container"),b=document.querySelector(".ChaZD-arrow-main");a&&document.documentElement.removeChild(a),b&&document.documentElement.removeChild(b)});var s=function(a){if(!j){if(k)if("ctrl"===l){if(!a.ctrlKey&&!a.metaKey)return void(d.again=0)}else if("alt"===l){if(!a.altKey)return void(d.again=0)}else if("shift"===l&&!a.shiftKey)return void(d.again=0);e(a)}},t=null,u=function(a){m&&(t=a.target,a.shiftKey&&w(a))},v=function(a){m&&(t&&t.classList.contains("ChaZD-link")&&x(a,!0),t=null)},w=function(a){t&&a.shiftKey&&(y(a),t.setAttribute("ChaZD-href",t.getAttribute("href")),t.removeAttribute("href"),t.classList.add("ChaZD-link"))},x=function(a,b){t&&(b||16==a.keyCode)&&(t.setAttribute("href",t.getAttribute("ChaZD-href")),t.removeAttribute("ChaZD-href"),t.classList.remove("ChaZD-link"))},y=function(a){m&&a.shiftKey&&window.getSelection().empty()};document.documentElement.addEventListener("mouseup",s),document.documentElement.addEventListener("mouseover",function(a){("A"===a.target.nodeName||"a"===a.target.nodeName)&&u(a)}),document.documentElement.addEventListener("mouseout",function(a){("A"===a.target.nodeName||"a"===a.target.nodeName)&&v(a)}),document.documentElement.addEventListener("keydown",w),document.documentElement.addEventListener("keyup",x),document.documentElement.addEventListener("selectstart",s)}();