function ChaZD(a,b,c){this.wordSource=b;var d=urls.dict+a,e=this,f=new XMLHttpRequest;f.open("GET",d,!0),f.onreadystatechange=function(){if(4==f.readyState){var a=e.parseResult.call(e,f.responseText);c(a)}},f.send()}function showNotification(a){if(Notifications){var b=null,c=Notifications.checkPermission();return 0===c?(b=Notifications.createNotification(a.icon||chrome.extension.getURL("icons/icon128.png"),a.title||"ChaZD 查字典",a.content),b.onclick=function(){window.open("https://chrome.google.com/webstore/detail/chazd/nkiipedegbhbjmajlhpegcpcaacbfggp")},b.show()):Notifications.requestPermission(),b}}ChaZD.prototype.checkErrorCode=function(a){var b={message:"",error:0,errorCode:0};switch(a){case 0:b.message="query success";break;case 20:b.message="要翻译的文本过长",b.error=1,b.errorCode=20;break;case 30:b.message="无法进行有效的翻译",b.error=1,b.errorCode=30;break;case 40:b.message="不支持的语言类型",b.error=1,b.errorCode=40;break;case 50:b.message="无效的key",b.error=1,b.errorCode=50;break;case 60:b.message="无辞典结果",b.error=1,b.errorCode=60}return b},ChaZD.prototype.parseResult=function(a){var b=JSON.parse(a),c={},d=this.checkErrorCode(b.errorCode);if(c.haveWebTranslation=!1,d.error)c.errorCode=d.errorCode;else{var e=this.initTitle(b);if(c.titleBlock=e.titleBlock,c.haveTranslation=e.haveTranslation,void 0!==b.basic){var f=this.parseBasicResult(b);c.basicBlock=f}if(void 0!==b.web){var g=this.parseWebResult(b);c.haveWebTranslation=!0,c.webBlock=g}}return c.validMessage=d.message,c},ChaZD.prototype.initTitle=function(a){var b=a.translation,c=a.query,d=!0;trim(c.toLowerCase())===trim(b.toString().toLowerCase())&&(d=!1);var e=this.initVoice(c);c=c.length>=50&&"select"==this.wordSource?this.shortWord(c):c;var f=fmt(frame.titleWord,c,e),g=fmt(frame.titleTranslation,b.toString());return{titleBlock:fmt(frame.titleContainer,f,g,c.length>=50?"long-text":""),haveTranslation:d}},ChaZD.prototype.shortWord=function(a){return a.slice(0,a.lastIndexOf(" ",50)).concat(" ...")},ChaZD.prototype.parseBasicResult=function(a){var b=a.basic,c=a.query,d=this.parseBasicPhonetic(b,c),e=this.parseBasicExplains(b,c),f=fmt(frame.basicContainer,d,e);return f},ChaZD.prototype.parseBasicPhonetic=function(a,b){var c=a["uk-phonetic"],d=a["us-phonetic"];if(void 0!==c&&void 0!==d){var e=this.initVoice(b,1),f=fmt(frame.ukPhoneticContainer,"["+c+"]"+e),g=this.initVoice(b,2),h=fmt(frame.usPhoneticContainer,"["+d+"]"+g);return fmt(frame.phoneticContainer,f,h)}return fmt(frame.phoneticContainer,"","")},ChaZD.prototype.initVoice=function(a,b){var c=urls.voice+a;void 0!==b&&(c=c+"&type="+b);var d="";return d=1===b?"英音":2===b?"美音":"真人发音",fmt(frame.voiceContainer,c,d)},ChaZD.prototype.parseBasicExplains=function(a){var b,c=a.explains,d="";for(b=0;b<c.length;b++){var e=c[b],f=e.indexOf(". "),g=-1!==f?e.slice(0,f+1):"",h=this.parseProperty(g),i=fmt(frame.propertyContainer,h,g),j=-1!==f?e.slice(f+1):e,k=fmt(frame.explain,i,j);d+=k}return fmt(frame.explainsContainer,fmt(frame.explainsList,d))},ChaZD.prototype.parseProperty=function(a){var b="";switch(a){case"adj.":b="形容词";break;case"adv.":b="副词";break;case"n.":b="名词";break;case"vi.":b="不及物动词";break;case"vt.":b="及物动词";break;case"prep.":b="介词";break;case"conj.":b="连词";break;case"int.":b="感叹词";break;case"abbr.":b="代词";break;case"pron.":b=""}return b},ChaZD.prototype.parseWebResult=function(a){var b,c=a.web,d="";for(b=0;b<c.length;b++){var e=fmt(frame.webExplain,c[b].key,c[b].value);d+=e}return fmt(frame.webExplainsContainer,fmt(frame.webExplainsList,d))},window.Notifications=window.Notifications||window.webkitNotifications,chrome.runtime.onInstalled.addListener(function(a){"install"===a.reason?showNotification({title:"感谢支持ChaZD！",content:"ChaZD力求成为最简洁易用的Chrome词典扩展，欢迎提出您的意见或建议。如果觉得ChaZD还不错，记得给5星好评哦:)"}):"update"===a.reason&&showNotification({title:"ChaZD 更新到0.8.10版啦！",content:"新增划词自动发音功能，可以在设置中开启或关闭该功能；\n接口改用https协议；\n优化用户体验。"})}),chrome.storage.sync.get(null,function(a){if(void 0===a.showTips)chrome.storage.sync.set(settings);else{for(var b in a)void 0===settings[b]?chrome.storage.sync.remove(b):settings[b]=a[b];chrome.storage.sync.set(settings)}}),chrome.runtime.onMessage.addListener(function(a,b,c){return new ChaZD(a.queryWord,a.source,c),!0});